{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chalo Saathi</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <style>
    .autocomplete-wrapper {
  position: relative;
}

.autocomplete-suggestions {
  position: absolute;
  background: white;
  display: none;
  border-radius: 8px;
  margin-top: 2px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  max-height: 200px;
  overflow-y: auto;
  width: 100%;   /* match input width */
  z-index: 1000;
}

.autocomplete-suggestions div {
  padding: 10px;
  cursor: pointer;
  transition: background 0.2s;
  font-size: 14px;
}

.autocomplete-suggestions div:hover {
  background: #f1f1f1;
}
  </style>
</head>

<body>

  <header>
    
    <img src="{% static 'images/chalosaathi.jpg' %}" alt="ChaloSaathi Logo" width="200px">
    <h1>ChaloSaathi</h1>
    <p>Share rides to your workplace and save on expenses!</p>
  </header>

  <nav>
    <div class="left">
      <a href="{% url 'index'%}">Home</a>
 <a href="#findride">Find a Ride</a>
  <a href="#offerride">Offer a Ride</a>
      <a href="{% url 'feedback' %}">My Rides</a>
      <a href="{% url 'profile' %}">Profile</a>
  <a href="{% url 'aboutus' %}">About Us</a>
  

    </div>
    {% if user.is_authenticated %}
    <a href="{% url 'profile' %}">
      {% if avatar %}
        <img src="{{ avatar }}" alt="Avatar" class="nav-avatar">
      {% else %}
        <img src="{% static 'images/default-avatar.png' %}" alt="Avatar" class="nav-avatar">
      {% endif %}
    </a>
  {% else %}
    <a href="{% url 'login' %}">Login/Signup</a>
  {% endif %}
  </nav>

  <div class="hero">
    <h1>Find Your Ride Partner Today</h1>
    <p>Connect with people going to the same place and split the travel costs.</p>

  <div class="steps-container">
    <div class="step-card">
      <h3>Step 1 : Sign Up</h3>
      <p>Create an account and verify your profile for safety.</p>
    </div>

    <div class="step-card">
      <h3>Step 2 : Search or offer</h3>
      <p>Find rides or offer your own based on location and time.</p>
    </div>

    <div class="step-card step-3">
      <div>
        <h3>Step 3 : Match & Ride</h3>
        <p>Chat, confirm, and share the ride expenses.</p>
      </div>
    </div>
  </div>
  </div>
  <button type="button" class="toggle-btn" onclick="toggleForm()">Publish your Ride</button>
  <div class="container">
    
  <div id="ride-card" class="card">
    <h2 id="formTitle">Find a Ride</h2>

   <form id="findrideForm" class="active" method="POST" action="{% url 'find_ride' %}">
    {% csrf_token %}
    <label for="gender">Gender:</label>
    <select id="gender" name="gender" required>
        <option value="" disabled selected hidden>Select Gender...</option>
        <option value="any">Any</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
    </select>

    <label for="from">From:</label>
    <input type="text" id="from" name="from" placeholder="Enter Pickup Location" required>
    <input type="hidden" id="pickup_coords1" name="pickup_coords1">
    <div id="from-suggestions1" class="autocomplete-suggestions"></div>

    <label for="to">To:</label>
    <input type="text" id="to" name="to" placeholder="Enter Destination" required>
    <input type="hidden" id="destination_coords1" name="destination_coords1">
    <div id="to-suggestions1" class="autocomplete-suggestions"></div>

    <label for="date">Date:</label>
    <input type="date" id="date" name="date" required>

    <label for="time">Time:</label>
    <input type="time" id="time" name="time" required>

    <div class="btn-group">
        <button type="submit">Search Rides</button>
    </div>
</form>
    
    <form id="offerrideForm" method="POST" action="{% url 'offer_ride' %}">
    {% csrf_token %}
    <label for="gender2">Gender:</label>
    <select id="gender2" name="gender" required>
        <option value="" disabled selected hidden>Select Gender...</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
        <option value="any">Both</option>
    </select>

    <label for="from2">Pickup:</label>
    <input type="text" id="from2" name="pickup_address" placeholder="Enter Pickup Location" required>
    <input type="hidden" id="pickup_coords" name="pickup_coords">
    <div id="from-suggestions" class="autocomplete-suggestions"></div>

    <label for="to2">Destination:</label>
    <input type="text" id="to2" name="destination_address" placeholder="Enter Destination" required>
    <input type="hidden" id="destination_coords" name="destination_coords">
    <div id="to-suggestions" class="autocomplete-suggestions"></div>

    <label for="vehino">Vehicle Number:</label>
    <input type="text" id="vehino" name="vehino" placeholder="Enter Vehicle Registration Number" required>

    <label for="vehiname">Vehicle Model Name:</label>
    <input type="text" id="vehiname" name="vehiname" placeholder="Enter Vehicle Model Name" required>

    <label for="vehicletype">Vehicle Type:</label>
    <select id="vehicletype" name="vehicletype" required>
        <option value="two-wheeler">Two-Wheeler</option>
        <option value="four-wheeler">Four-Wheeler</option>
    </select>

    <label for="date2">Date:</label>
    <input type="date" id="date2" name="date" required>

    <label for="time2">Time:</label>
    <input type="time" id="time2" name="time" required>

    <div class="btn-group">
        <button type="submit">Post Ride</button>
    </div>
</form>

    
    
  </div>
</div>


    <div class="divider"></div>

    <section>
      <h1>Our Other Platforms</h1>

      <div class="platforms">
        <div class="card">
          <a href="https://internsaathi.com/" target="_blank">
          <img src="{% static 'images/intersaathi.jpg' %}" alt="Intern Saathi">
          </a>
          <p>Your trusted partner for<br>
            internships, connecting students<br>
            with industry-ready opportunities.
          </p>

        </div>

        <div class="card">
          <a href="https://naukrisaathi.com/" target="_blank">
          
          <img src="{% static 'images/naukrisaathi.jpg' %}" alt="Naukri Saathi">
          </a>
          <p>Empowering job seekers and<br>
            professionals to land the right<br>
            roles across India</p>
        </div>

        <div class="card">
           <a href="https://tasksaathi.com/" target="_blank">
          <img src="{% static 'images/tasksaathi.jpg' %}" alt="Task Saathi">
          </a>
          <p>Task Saathi – Making work<br>
            effortless, organized, and stress-free.</p>
        </div>

        <div class="card">
                  <a href="https://kaushalsaathi.com/" target="_blank">
          <img src="{% static 'images/kaushalsaathi.jpg' %}" alt="Kaushal Saathi">
                  </a>
          <p>Kaushal Saathi – Bridging the gap<br>
            between potential and<br>
            opportunity for every woman.
          </p>
        </div>

        <div class="card">
          <a href="https://sunsysglobal.com/" target="_blank">
          <img src="{% static 'images/sunsys.jpg' %}" alt="Sunsys">
          </a>
          <p>Sunsys Techsol – Your trusted<br>
            partner in renewable and<br>
            affordable solar energy.</p>
    
        </div>
      </div>
    </section>

    <footer>
      <div class="footer-container">
        <div class="footer-left">
          <h3>Contact Us :-</h3>
          <p>info@chalosaathi.com</p>
          <p>admin@chalosaathi.com</p>
    
        </div>

          <div class="footer-top">
    <p>
      Powered by 
      <a href="https://sunsysglobal.com/" target="_blank">
      <img src="{% static 'images/sunsys.jpg' %}" alt="Sunsys Logo" class="footer-logo">
      </a>
      <a href="https://www.linkedin.com/company/sunsystechsol-pvt-ltd/" target="blank">
        <img src="{% static 'images/linkedin.svg' %}" alt="LinkedIn" class="social-icon">
      </a>
    </p>
  </div>

    <div class="footer-social">
    <p>Follow us on</p>
     <a href="https://www.linkedin.com/company/sunsystechsol-pvt-ltd/" target="_blank">
        <img src="{% static 'images/linkedin.svg' %}" alt="LinkedIn" class="social-icon">
      </a>
    <a href="https://www.instagram.com/chalo_saathi/" target="_blank">
      <img src="{% static 'images/instagram.png' %}" alt="Instagram" class="social-icon">
    </a>
    <a href="https://x.com/Chalo_Saathi" target="_blank">
      <img src="{% static 'images/twitter.png' %}" alt="Twitter" class="social-icon">
    </a>
  </div>

      <div class="footer-bottom">
        <p>© 2025 Chalo Saathi. All Rights Reserved. |
          <a href="#">Privacy Policy</a> |
          <a href="#">Terms & Conditions</a>
        </p>
      </div>
    </footer>
    <script>
  let isFindRide = true;
  function toggleForm() {
    const findForm = document.getElementById("findrideForm");
    const offerForm = document.getElementById("offerrideForm");
    const formTitle = document.getElementById("formTitle");
    const toggleBtn = document.querySelector(".toggle-btn");

    if (isFindRide) {
      findForm.classList.remove("active");
      offerForm.classList.add("active");
      formTitle.textContent = "Publish Your Ride";
      toggleBtn.textContent = "Find a Ride";
    } else {
      offerForm.classList.remove("active");
      findForm.classList.add("active");
      formTitle.textContent = "Find a Ride";
      toggleBtn.textContent = "Publish Your Ride";
    }

    isFindRide = !isFindRide;
  }
  function showAlert() {
            alert("Please verify driver's id proof and vehicle's registration number same as mention");
        }
</script>
 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder@2.4.0/dist/Control.Geocoder.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Check if Leaflet is loaded
    if (typeof L === 'undefined') {
        console.error('Leaflet library not loaded');
        return;
    }

    // Initialize the Nominatim geocoder
    const geocoder = L.Control.Geocoder.nominatim();

    // Reusable autocomplete function
    function setupAutocomplete(inputId, suggestionsId, coordsId) {
        const input = document.getElementById(inputId);
        const suggestions = document.getElementById(suggestionsId);
        const coords = document.getElementById(coordsId);
        
        if (!input || !suggestions || !coords) {
            console.error(`Missing elements for ${inputId}`);
            return;
        }
        
        // Add loading indicator
        const loadingIndicator = document.createElement('div');
        loadingIndicator.className = 'loading-indicator';
        loadingIndicator.textContent = 'Loading...';
        loadingIndicator.style.display = 'none';
        suggestions.parentNode.insertBefore(loadingIndicator, suggestions);

        input.addEventListener('input', function () {
            const query = input.value.trim();
            if (query.length > 2) { // Reduced from 3 to 2 for better UX
                loadingIndicator.style.display = 'block';
                
                geocoder.geocode(query, function (results) {
                    loadingIndicator.style.display = 'none';
                    suggestions.innerHTML = '';
                    
                    if (results && results.length > 0) {
                        suggestions.style.display = 'block';
                        results.forEach(result => {
                            const div = document.createElement('div');
                            div.textContent = result.name;
                            div.className = 'suggestion-item';
                            div.addEventListener('click', function () {
                                input.value = result.name;
                                coords.value = `${result.center.lat},${result.center.lng}`;
                                suggestions.innerHTML = '';
                                suggestions.style.display = 'none';
                                
                                // Trigger change event in case other scripts need it
                                input.dispatchEvent(new Event('change'));
                            });
                            suggestions.appendChild(div);
                        });
                    } else {
                        suggestions.style.display = 'none';
                    }
                }, function(error) {
                    loadingIndicator.style.display = 'none';
                    console.error('Geocoding error:', error);
                    suggestions.innerHTML = '<div class="error-message">Error fetching locations</div>';
                    suggestions.style.display = 'block';
                });
            } else {
                suggestions.innerHTML = '';
                suggestions.style.display = 'none';
            }
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', function (e) {
            if (e.target !== input && !suggestions.contains(e.target)) {
                suggestions.style.display = 'none';
            }
        });

        // Hide suggestions when pressing Escape key
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                suggestions.style.display = 'none';
            }
        });
    }

    // Setup autocomplete for all location inputs
    setupAutocomplete('from', 'from-suggestions1', 'pickup_coords1');
    setupAutocomplete('to', 'to-suggestions1', 'destination_coords1');
    setupAutocomplete('from2', 'from-suggestions', 'pickup_coords');
    setupAutocomplete('to2', 'to-suggestions', 'destination_coords');

    // Form validation
    document.getElementById('findrideForm').addEventListener('submit', function (e) {
        const pickupCoords = document.getElementById('pickup_coords1');
        const destinationCoords = document.getElementById('destination_coords1');
        
        if (!pickupCoords.value || !destinationCoords.value) {
            e.preventDefault();
            alert('Please select valid pickup and destination locations from the suggestions.');
        }
    });

    document.getElementById('offerrideForm').addEventListener('submit', function (e) {
        const pickupCoords = document.getElementById('pickup_coords');
        const destinationCoords = document.getElementById('destination_coords');
        
        if (!pickupCoords.value || !destinationCoords.value) {
            e.preventDefault();
            alert('Please select valid pickup and destination locations from the suggestions.');
        }
    });
});
</script>



<style>
.autocomplete-suggestions {
    position: absolute;
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    max-height: 200px;
    overflow-y: auto;
    width: 100%;
    z-index: 1000;
    display: none;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.suggestion-item {
    padding: 10px;
    cursor: pointer;
    border-bottom: 1px solid #f1f1f1;
}

.suggestion-item:hover {
    background-color: #f1f1f1;
}

.suggestion-item:last-child {
    border-bottom: none;
}

.loading-indicator {
    padding: 10px;
    color: #666;
    font-style: italic;
}

.error-message {
    padding: 10px;
    color: #d9534f;
}

/* Make sure the input position is relative for absolute positioning of suggestions */
input[type="text"] {
    position: relative;
}
</style>

</body>
</html>
